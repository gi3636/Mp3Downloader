# 🎵 YouTube 音乐下载器

一个本地运行的 YouTube 音乐下载工具，支持播放列表/专辑下载，转换为高品质 MP3，内置音乐播放器。

## ✨ 功能特性

### 下载功能
- 📥 **播放列表批量下载** - 支持整个播放列表/专辑批量下载
- � **选择性下载** - 可选择播放列表中的特定曲目下载
- �🎨 **自动获取封面** - 自动获取每首歌的封面图
- 📊 **实时进度追踪** - 显示下载进度和当前曲目
- ⏸️ **暂停/继续** - 支持暂停和继续下载任务
- � **ZIP 打包** - 下载完成后自动打包为 ZIP

### 播放功能
- 🎵 **内置播放器** - 无需下载即可在线播放
- 🔀 **随机播放** - 支持顺序/随机播放模式
- ⌨️ **快捷键控制** - 空格键暂停/播放
- 💾 **播放状态保存** - 刷新页面后恢复播放进度
- 🎼 **专辑模式** - 按专辑分组浏览和播放

### 管理功能
- 📚 **音乐库管理** - 统一管理所有已下载的音乐
- 🔍 **搜索功能** - 快速搜索曲目
- 🗂️ **多种排序** - 支持按时间、字母、专辑排序
- 🗑️ **删除功能** - 支持删除单曲或整个任务
- 🖼️ **封面修复** - 提供脚本修复已下载文件的封面

## 🚀 快速开始

### 环境要求

- Python 3.10+
- macOS（项目内置 `yt-dlp_macos`）
- `ffmpeg`（用于音频转换）
- Node.js 18+（用于前端构建）

### 1. 安装依赖

```bash
# 安装 ffmpeg（macOS）
brew install ffmpeg

# 初始化项目
make init
```

### 2. 启动服务

```bash
make run
```

默认访问地址：http://127.0.0.1:5001

如需修改端口：
```bash
PORT=8080 make run
```

### 3. 使用 Raycast 快速启动（可选）

项目包含 Raycast 脚本，可以一键启动：

```bash
# 脚本位置
/Users/你的用户名/Documents/raycast-scripts/youtube.sh
```

在 Raycast 中搜索 "YouTube 下载器" 即可快速启动。

## 🧭 使用说明

### 下载音乐

1. 在下载页面粘贴 YouTube 链接
   - 支持单个视频
   - 支持播放列表
   - 支持频道链接（会列出所有播放列表供选择）

2. 选择要下载的曲目（播放列表模式）
   - 可以全选或选择特定曲目
   - 显示每首歌的封面和时长

3. 开始下载
   - 实时显示下载进度
   - 支持暂停/继续
   - 可以取消下载

4. 下载完成
   - 自动打包为 ZIP
   - 可以在线播放
   - 自动添加到音乐库

### 播放音乐

- **播放控制**：播放/暂停、上一首/下一首、随机播放
- **快捷键**：空格键暂停/播放
- **进度条**：拖动进度条跳转
- **播放列表**：点击任意曲目开始播放
- **删除曲目**：播放条右侧有删除按钮

### 音乐库管理

- **搜索**：在搜索框输入关键词
- **排序**：
  - 最新添加 / 最早添加
  - A-Z / Z-A
  - 按专辑分组
- **专辑模式**：按专辑浏览，点击专辑查看曲目
- **删除**：鼠标悬停在曲目上显示删除按钮

## 🛠️ 高级功能

### 修复已下载文件的封面

如果之前下载的文件封面不正确，可以运行修复脚本：

```bash
.venv/bin/python fix_covers.py
```

脚本会：
- 扫描所有已下载的音乐
- 通过 YouTube 搜索获取正确的封面
- 更新封面数据

⚠️ 注意：此过程需要联网，每首歌约需 5-15 秒。

## 📁 项目结构

```
├── app.py              # Flask 主应用
├── config.py           # 配置文件
├── models.py           # 数据模型
├── job_manager.py      # 下载任务管理
├── ytdlp_service.py    # yt-dlp 封装
├── tracks_service.py   # 曲目文件服务
├── fix_covers.py       # 封面修复脚本
├── web/                # 前端源码（React + TypeScript）
├── static/             # 前端构建产物
├── download/           # 下载的 MP3 文件
├── jobs/               # 任务临时文件
└── yt-dlp_macos        # yt-dlp 可执行文件
```

## 🔧 技术栈

- **后端**: Python + Flask
- **前端**: React + TypeScript + Vite
- **UI**: Lucide Icons
- **下载**: yt-dlp
- **音频**: ffmpeg + mutagen

## 🧩 常见问题

### 1. 报错提示需要 ffmpeg

```bash
brew install ffmpeg
ffmpeg -version
```

### 2. yt-dlp 权限错误

```bash
chmod +x ./yt-dlp_macos
```

### 3. 端口被占用

```bash
PORT=8080 make run
```

### 4. 下载速度慢

- 检查网络连接
- YouTube 可能限速，属于正常现象
- 可以尝试使用代理

### 5. 封面显示不正确

运行封面修复脚本：
```bash
.venv/bin/python fix_covers.py
```

## 📝 开发说明

### 前端开发

```bash
cd web
npm install
npm run dev
```

### 构建前端

```bash
cd web
npm run build
```

### 打包桌面应用（Tauri）

```bash
make bundle
```

## ⚠️ 注意事项

- 本工具仅供个人学习使用
- 请遵守相关法律法规和平台服务条款
- 下载的内容请勿用于商业用途
- 需要安装 ffmpeg 才能转换音频格式

## 📄 许可证

MIT License
